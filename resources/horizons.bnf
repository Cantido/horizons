(* Overall document structure *)

S ::= geophysical-document | ephemeredes-document;

<geophysical-document> ::=
    <garbage*>,
    <separator>, file-header,
    (<ws>        geophysical-data)?
    (<ws>        physical-properties)?
    (<ws>        dynamical-characteristics)?
    <separator> <#"."*> <select-prompt>;

<ephemeredes-document> ::=
"*******************************************************************************
Ephemeris / PORT_LOGIN Sat Mar 25 20:10:59 2017 Pasadena, USA    / Horizons
*******************************************************************************
Target body name: Mars (499)                      {source: mar097}
Center body name: Earth (399)                     {source: mar097}
Center-site name: BODY CENTER
*******************************************************************************
Start time      : A.D. 2017-Mar-26 00:00:00.0000 TDB
Stop  time      : A.D. 2017-Apr-09 00:00:00.0000 TDB
Step-size       : 60 minutes
*******************************************************************************
Center geodetic : 0.00000000,0.00000000,0.0000000 {E-lon(deg),Lat(deg),Alt(km)}
Center cylindric: 0.00000000,0.00000000,0.0000000 {E-lon(deg),Dxy(km),Dz(km)}
Center radii    : 6378.1 x 6378.1 x 6356.8 km     {Equator, meridian, pole}
Output units    : KM-D
Output type     : GEOMETRIC cartesian states
Output format   : 3 (position, velocity, LT, range, range-rate)
Reference frame : ICRF/J2000.0
Coordinate systm: Ecliptic and Mean Equinox of Reference Epoch
*******************************************************************************
JDTDB
   X     Y     Z
   VX    VY    VZ
   LT    RG    RR
*******************************************************************************
$$SOE
2457838.500000000 = A.D. 2017-Mar-26 00:00:00.0000 TDB
   2.469362459741699E+08  2.163270043150773E+08  1.830259394692242E+06
  -1.998813030648808E+06  3.666065138258934E+06  6.696681569533017E+04
   1.267450720461575E-02  3.282959521852242E+08  9.126279731446180E+05
2457838.541666667 = A.D. 2017-Mar-26 01:00:00.0000 TDB
   2.468529160360132E+08  2.164797382910827E+08  1.833049542549446E+06
  -2.001023930041054E+06  3.665165459382345E+06  6.696028166693833E+04
   1.267597516016114E-02  3.283339752701266E+08  9.124800700851079E+05
2457838.583333333 = A.D. 2017-Mar-26 02:00:00.0000 TDB
   2.467694939859131E+08  2.166324347491285E+08  1.835839418182880E+06
  -2.003234403636737E+06  3.664264275887711E+06  6.695374894435656E+04
   1.267744287763115E-02  3.283719921883844E+08  9.123319740644478E+05
2457838.625000000 = A.D. 2017-Mar-26 03:00:00.0000 TDB
   2.466859798416550E+08  2.167850936264845E+08  1.838629021642193E+06
  -2.005444449170344E+06  3.663361586019475E+06  6.694721722265016E+04
   1.267891035671491E-02  3.284100029319452E+08  9.121836846421708E+05
2457838.666666667 = A.D. 2017-Mar-26 04:00:00.0000 TDB
   2.466023736211360E+08  2.169377148603601E+08  1.841418352956861E+06
  -2.007654063627803E+06  3.662457388759074E+06  6.694068589220142E+04
   1.268037759710164E-02  3.284480074927596E+08  9.120352024186496E+05
2457838.708333333 = A.D. 2017-Mar-26 05:00:00.0000 TDB
   2.465186753423841E+08  2.170902983879470E+08  1.844207412130415E+06
  -2.009863243848363E+06  3.661551684284421E+06  6.693415437482002E+04
   1.268184459848234E-02  3.284860058628230E+08  9.118865288893367E+05
$$EOE
*******************************************************************************
Coordinate system description:

  Ecliptic and Mean Equinox of Reference Epoch

    Reference epoch: J2000.0
    XY-plane: plane of the Earth's orbit at the reference epoch
              Note: obliquity of 84381.448 arcseconds wrt ICRF equator (IAU76)
    X-axis  : out along ascending node of instantaneous plane of the Earth's
              orbit and the Earth's mean equator at the reference epoch
    Z-axis  : perpendicular to the xy-plane in the directional (+ or -) sense
              of Earth's north pole at the reference epoch.

  Symbol meaning [1 day=86400.0 s]:

    JDTDB    Julian Day Number, Barycentric Dynamical Time
      X      X-component of position vector (km)
      Y      Y-component of position vector (km)
      Z      Z-component of position vector (km)
      VX     X-component of velocity vector (km/day)
      VY     Y-component of velocity vector (km/day)
      VZ     Z-component of velocity vector (km/day)
      LT     One-way down-leg Newtonian light-time (day)
      RG     Range; distance from coordinate center (km)
      RR     Range-rate; radial velocity wrt coord. center (km/day)

Geometric states/elements have no aberrations applied.

 Computations by ...
     Solar System Dynamics Group, Horizons On-Line Ephemeris System
     4800 Oak Grove Drive, Jet Propulsion Laboratory
     Pasadena, CA  91109   USA
     Information: http://ssd.jpl.nasa.gov/
     Connect    : telnet://ssd.jpl.nasa.gov:6775  (via browser)
                  http://ssd.jpl.nasa.gov/?horizons
                  telnet ssd.jpl.nasa.gov 6775    (via command-line)
     Author     : Jon.D.Giorgini@jpl.nasa.gov
*******************************************************************************\n"
(* General data types *)

<garbage> ::= #"[\d\\[\?1h\\= \^\>]+" | <ws>;
separator ::= <ws>, (short-sep | long-sep), <ws>, separator?;
short-sep ::= #"\*{79}";
long-sep ::= #"\*{110}";

space ::= #"[\s\n\r]";
ws ::= space*;

<digit> ::= #"\d";
integer ::= #"-?\d+" | comma-separated-integer;
comma-separated-integer ::= #"\d?\d?\d?,(\d\d\d,)+\d\d\d";
<integer-with-error> ::= #"\d+\(?\+\-\d+\)?";
float ::= #"\-?\d*\.\d*";
<float-with-error> ::= (#"\d*\.\d*\(\d\+\-\d\)") | (#"\d*\.\d*\s?\+\-\s?\d*\.\d*");
<approximate-integer> ::= #"~\d+";

sci-not ::= significand <ws "("? sci-not-separator> exponent <")"?>
<sci-not-separator> := (("x" | "*") ws "10^") | "E";
significand ::= float | integer;
exponent ::= integer;

timestamp ::= era?, <space>, date, <ws>, time, <space>, time-zone?;

date ::= (year <"-"> month <"-"> day) | (month <" "> day <", "> year);

era ::= "A.D."
year ::= integer;
month ::= "Jan" | "Feb" | "Mar" | "Apr" | "May" | "Jun" | "Jul" | "Aug" | "Sep" | "Oct" | "Nov" | "Dec";
day ::= integer
time ::= hour-of-day <":"> minute-of-hour (<":"> second-of-minute <"."> millisecond-of-second)?;

hour-of-day ::= integer;
minute-of-hour ::= integer;
second-of-minute ::= integer;
millisecond-of-second ::= integer;

(* TODO: property parse a seconds measurement like 22.4, currently this things there are 4 milliseconds *)
duration ::= days? (hours <ws? ("h" | "hr") ws>)? (minutes <ws? ("m" | "minutes") ws?>)? (seconds <"."> milliseconds <"s">)?;
days ::= (float | integer) <ws? "d" ws?>;
hours ::= float | float-with-error | integer;
minutes ::= integer;
seconds ::= integer;
milliseconds ::= integer;

time-zone ::= "UT"

(* Units using the UN/CEFACT Common Codes for Units of Measurement
    See http://www.unece.org/fileadmin/DAM/cefact/recommendations/rec20/rec20_Rev9e_2014.xls
*)

unit-D54 ::= "W/m^2" | "Wm^2"; (* [sic] *)
unit-M62 ::= "("? ("km/s" | "km s^-1") ")"?;
unit-KEL ::= "K";

(* Domain-specific data types *)

body-name ::= #"\w+";
body-id ::= integer;

(* Document proper *)

file-header ::=
    revision-date   <space+>
    body-name       <space+>
    body-id         <space+>
    <#"\/ \d"?>

revision-date ::= <"Revised: "> date;

dynamical-characteristics ::= <dynamical-characteristics-header>  (<ws> geophysical-field)+;
geophysical-data ::=  <geophysical-data-header> (<ws> geophysical-field)+;
physical-properties ::= <physical-properties-header>  (<ws> geophysical-field)+;

<geophysical-field> ::=
    <"Mass layers:"> |
    <obliquity-source> |
    <surface-area-title> |
    a-roche-ice |
    atmospheric-mass |
    atmospheric-pressure |
    core-radius |
    crust-mass |
    density |
    dipole-tilt-offset |
    equatorial-gravity |
    equatorial-radius |
    escape-velocity |
    fig-offset |
    flattening |
    fluid-core-radius |
    g-equatorial |
    g-o |
    g-polar |
    geometric-albedo |
    gm-1-sigma |
    grav-spectral-fact |
    heat-flow-mass |
    hill-sphere-radius |
    hydrostatic-flattening |
    inferred-rotation-period |
    inner-core-mass |
    inner-core-radius |
    j2 |
    ks |
    m |
    magnetic-moment |
    mantle-mass |
    mass |
    mass-ratio-from-sun |
    maximum-angular-diameter |
    mean-daily-motion |
    mean-radius |
    mean-sidereal-orbital-period-days |
    mean-sidereal-orbital-period-years |
    mean-solar-day |
    mean-temperature |
    moment-of-inertia |
    monent-of-inertia-upper-bound |
    obliquity-to-orbit |
    ocean-mass |
    offset |
    orbit-velocity |
    outer-core-mass |
    polar-axis |
    polar-gravity |
    polar-radius |
    potential-love-k2 |
    rocky-core-mass |
    rotation-rate |
    semi-major-axis |
    sidereal-rotation-period |
    solar-constant |
    standard-gravitational-parameter |
    surface-area-land |
    surface-area-sea |
    topo-spectral-fact |
    visual-magnitude |
    visual-magnitude-opposition |
    volume |
    y-factor;

equals ::= space* "=" space*;

geophysical-data-header ::= "GEO"? "PHYSICAL DATA" ws "(update" "d"? ws date "):";
dynamical-characteristics-header ::= "DYNAMICAL CHARACTERISTICS:";
physical-properties-header ::= "PHYSICAL PROPERTIES (revised " date "):";

a-roche-ice ::= <"A_roche(ice)/Rp" | "Aroche(ice)/Rp"> <equals> float;
atmospheric-mass ::= <"Atmos"> <equals> sci-not <" kg">;
atmospheric-pressure ::= <("Atm." | "Atmos.") " pressure" " (bar)"?> <equals> (float | integer)? <" bar"?>;
core-radius ::= <"Core radius (km)"> <equals> approximate-integer;
crust-mass ::= <"crust"> <equals> sci-not <" kg">;
density ::= <"Density", (", gm cm^-3" | " (g cm^-3)" | " (g/cm^3)")> <equals> (float | float-with-error);
dipole-tilt-offset ::= <"Dipole tilt/offset"> <equals> #"\d+\.?\d*de?g/\d+\.\d+Rp"
equatorial-gravity ::= <"Equ. gravity  ms^-2"> <equals> float;
equatorial-radius ::= <"Equatorial Radius, Re" | "Equ. radius, km" | "Equat. radius (1 bar)"> <equals> (integer | integer-with-error | float | float-with-error) <" km"?>;
escape-velocity ::= <"Escape" ws ("vel." | "velocity") ws? unit-M62?> <equals> float <ws> <unit-M62?>;
fig-offset ::= <"Fig. offset (Rcf-Rcm)"> <equals> (float-with-error | "0.19+-01") <" km"?>;
flattening ::= <"Flattening" ", f"?> <equals> (#"\d/\d\d\d\.\d\d\d" | float)?;
fluid-core-radius ::= <"Fluid core rad"> <equals> integer <" km">;
(* equatorial & polar gravity? units seem right. What is g-o? *)
g-equatorial ::= <"ge, m s^-2 (equatorial)" | "Equ. grav, ge (m/s^2)"> <equals> float;
g-o ::= <"go, m s^-2               = "> float;
g-polar ::= <"gp, m s^-2 (polar)" | "Pol. grav, gp (m/s^2)"> <equals> (float | float-with-error);
geometric-albedo ::= <"Geometric albedo"> <equals> float;
gm-1-sigma ::= <"GM 1-sigma" ws? "(" ws? ( "km^3 s^-2" | "km^3/s^2" ) ws? ")"> <equals> #"\+\- ?\d\.?\d+";
grav-spectral-fact ::= <"Grav spectral fact u"> <equals> (sci-not | float);
heat-flow-mass ::= <"Heat flow/mass (x10^7)"> <equals>  integer? <ws "erg/gm*s">?;
hill-sphere-radius ::= <"Hill's sphere" ws ("rad." | "radius") ","? ws "Rp"?> <equals> (float | integer);
hydrostatic-flattening ::= <"Hydrostatic flat., fh"> <equals> float;
inferred-rotation-period ::= <"Inferred rot. period"> <equals> duration;
inner-core-mass ::= <"inner core     = "> sci-not <" kg">;
inner-core-radius ::= <"Inner core rad   = "> integer <" km">;
j2 ::= <"J2  (GEM T2, 1990)       = "> float;
ks ::= <"ks = 3*J2/m"> <equals> float;
m ::= <"m = w^2a^3/GM"> <equals> float;
magnetic-moment ::= <"Mag. mom (gauss Rp^3)" | "Magnetic moment" | "Mag.dip.mom(gauss-Rp^3)"> <equals> (#"< 1x10\^\-\d" | (float <ws "gauss Rp^3">?));
mantle-mass ::= <"mantle         = "> sci-not <" kg">;
mass ::= <"Mass (10^23 kg )" | "Mass, 10^24 kg" | "Mass (10^24 kg)" | "Mass (10^26 kg)">  <equals> (float | float-with-error);
mass-ratio-from-sun ::= <"Mass ratio " ("(Sun/" body-name ")" | "(sun/plnt)")> <equals> (integer | integer-with-error | float);
maximum-angular-diameter ::= <"Max. angular diam."> <equals> #'\d+\.\d+\"';
mean-daily-motion ::= <"Mean daily motion" ", n"?> <equals> float <ws> <"deg/d" | "dg/d">;
mean-radius ::= <(("Mean radius" ws ", "? "("? "km" ")"?) | "Volumetric mean radius")> <equals> (float-with-error | integer-with-error) <ws "km">?;
<mean-sidereal-orbit-label> ::= <"Mean"? ws ("sidereal" | "Sidereal") ws (("orb" "."?)  | "orbit")? ws? (("per" "."?) | "period")>;
mean-sidereal-orbital-period-years ::= <mean-sidereal-orbit-label> <equals> float <ws> <("yrs" | "y" | "yr")?>;
mean-sidereal-orbital-period-days ::= <mean-sidereal-orbit-label> <equals> float <ws> <("d" | "days")>;
mean-solar-day ::= <"Mean solar day" ", days"?> <equals> float <" d"?>;
mean-temperature ::= <("Atmos. temp. (1 bar)") | ("Mean Temperature" (" (" | ", ") unit-KEL ")"?)> <equals> (integer | integer-with-error)? <ws> <unit-KEL?>;
moment-of-inertia ::= <("Mom. of Inertia" | "Moment of inertia" | "Mom. of inert. I/MRo^2")> <equals> float?;
monent-of-inertia-upper-bound ::= <"I/MRo^2 (upper bound)"> <equals> float;
ocean-mass ::= <"oceans"> <equals> sci-not <" kg">;
obliquity-to-orbit ::= <"Obliquity to orbit"> <"[1]"?> <", deg"?> <equals> (float | #"\d.\d\d' \+/\- \d\.\d'") <" deg"?>;
offset ::= <"Offset (lat./long.)"> <equals> #"\d+d? ?\/ ?\d+d?" <ws "dg/dg">?;
orbit-velocity ::= <"Mean"? ws ("Orbit" | "orbit") ws ("vel." | "velocity") ","? ws unit-M62?> <equals> float <ws> <unit-M62?>;
outer-core-mass ::= <"outer core     = "> sci-not <" kg">;
polar-gravity ::= <"Polar gravity ms^-2"> <equals> float?;
polar-axis ::= <"Polar axis, km"> <equals> float;
polar-radius ::= <"Polar radius (km)"> <equals> integer-with-error;
potential-love-k2 ::= <("Potential Love # k2" | "Love no., k2")> <equals> <"~"?> (float | float-with-error)?;
rocky-core-mass ::= <"Rocky core mass (Mc/M)"> <equals> float?;
rotation-rate ::= <("Rot. Rate (x10^5 s)" | "Mean rot. rate, rad s^-1" | "Rot. rate(10^-4 rad/s)")> <equals> (float | sci-not);
semi-major-axis ::= <"Semi-major axis"> <equals> integer-with-error?;
solar-constant ::= <("Solar constant, " unit-D54) | "Planetary Solar Const"> <equals> float  <ws "("? unit-D54 ")"?>?;
sidereal-rotation-period ::= <("Sidereal rot. period" | "Sidereal period, hr" | "Sidereal period" | "Rotation period")> <equals> (duration | float);
standard-gravitational-parameter ::= <"GM" (", km^3 s^-2" | " (km^3 s^-2)" | " (km^3/s^2)" )> <equals> (float | integer);
surface-area-title ::= "Surface Area:";
surface-area-land ::= <"land           = "> sci-not <" km">;
surface-area-sea ::= <"sea            = "> sci-not <" km">;
topo-spectral-fact ::= <"Topo. spectral fact t"> <equals> (sci-not | integer);
visual-magnitude ::= <("Visual" | "Vis.") ws ("mag." | "magnitude") ws "V(1,0)"> <equals> float;
visual-magnitude-opposition ::= <"Vis. mag. (opposition)"> <equals> <"+"?> float;
volume ::= <("Volume (x10^10 km^3)" | "Volume, 10^10 km^3")> <equals> float;
y-factor ::= <"Y factor (He/H ratio)"> <equals> float-with-error?;

obliquity-source ::= "[1] Margot et al., Science 316, 2007";

select-prompt ::= "Select ... [E]phemeris, [F]tp, [M]ail, [R]edisplay, ?, <cr>:" <ws>;

